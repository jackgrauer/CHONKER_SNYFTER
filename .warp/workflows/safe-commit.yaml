name: "Safe Git Commit"
description: "Prevents terminal cascading bug with validated commit messages"
tags: ["git", "safety", "chonker"]
version: "1.0"

# Prevent the Warp terminal cascading output bug
# that occurs with multi-line git commit -m commands

parameters:
  - name: message
    description: "Commit message (will be validated for safety)"
    type: string
    required: false

command: |
  # CHONKER Safety Protocol: Git Commit Protection
  # Never use multi-line strings with git commit -m
  
  if [ -n "${message:-}" ]; then
    # Check for unsafe patterns
    if [[ "$message" == *$'\n'* ]]; then
      echo "⚠️ Multi-line message detected - using editor to prevent Warp bug"
      echo "Your message will be pre-filled in the editor:"
      echo "---"
      echo "$message"
      echo "---"
      git commit -e -m "$message"
    elif [ ${#message} -gt 72 ]; then
      echo "⚠️ Long message detected - using editor for better formatting"
      git commit -e -m "$message"
    else
      # Safe single-line commit
      git commit -m "$message"
    fi
  else
    # No message provided - open editor
    echo "📝 Opening editor for commit message"
    git commit -e
  fi

# Alternative commands for different scenarios
alternatives:
  simple: "git commit -m '{{message}}'"
  editor: "git commit -e"
  amend: "git commit --amend"
  
# Safety notes
safety_notes: |
  🛡️ This workflow prevents the Warp terminal cascading bug that occurs
  when using git commit -m with multi-line strings or unclosed quotes.
  
  ✅ Safe patterns:
  - git commit -m "single line message"
  - git commit -e (opens editor)
  
  ❌ Unsafe patterns (causes terminal corruption):
  - git commit -m "line 1\nline 2"
  - git commit -m "unclosed quote
  
  📚 Learn more: .warp/notebooks/known-issues.md
